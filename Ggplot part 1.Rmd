---
title: "ggplot notes part 1"
author: "Amanda Mae Woodward"
date: "2025-10-14"
output: html_document
---

# Learning Outcomes

By the end of this class, students should be able to: 
- Transform data to appropriate formats for graphs
- Create bar graphs,histograms, scatterplots, line graphs, and box plots in R 
- Change aesthetic properties of graphs, including themes and colors
- Incorporate third variables into graphs 

**Notes:** There are several ways that you can graph in R. In today's class, we'll be focusing primarily on `ggplot()`. It's my personal favorite way to graph because you can customize so many things. We won't be able to go through all of them, but today's class will serve as an introduction to graphing and an introduction to different types of customization. 
```{r}
library(ggplot2)
```


## Learning Outcome 1: Transform data to appropriate formats for graphs
We've already talked about how to transform data into wide and long format. For some of you, you may need to create a data frame that contains summary statistics to graph (e.g. bar graphs). Before we talk about how to make the graphs, I'm going to show you one way you can make a summary data frame. 

**summarySE**
To do this, we're going to use a function called `summarySE()`. It's in the Rmisc package
```{r}
library(Rmisc)
```

We'll try this with the diamonds dataset (located in ggplot). Specifically, we'll create a summary of price by color. 

Note: If you have a slow computer, make a subset of the diamonds dataset (typically, I use above 1 carat, but choose your favorite dimension)
```{r}
diamonds
library(tidyverse) #R wants you to load Rmisc FIRST, then Tidyverse. It's just fussy
data("diamonds")
```

The structure for summarySE is: 

`summarySE(data, measurevar(the variable you want to summarize), grouping variables, confidence interval)`
```{r}
priceByColor<- summarySE(diamonds, measurevar = "price", group = "color") #I do like this tbh
```

alternatively, you can use pipes to summarize your data and get it set up in the format you need for graphing. 

To do this, we could use the `group_by()` function and the `summarise()` function 

```{r}
diamonds %>% 
  group_by(color) %>% #sometimes you have to add dplyr:: before this
  summarise(meanPrice= mean(price), sd(price)) #sometimes you have to add dplyr:: before this
```


### Learning Outcome 1: Practice 
1. Open the penguins dataset. Create a dataset containing a summary of the flipper length by species.
```{r}
library(palmerpenguins)
data("penguins")
speciesFlipperLength<- summarySE(penguins, measurevar = "flipper_length_mm", group = "species", na.rm = TRUE)
speciesFlipperLength

pipeVersion<- penguins %>%
  group_by(species) %>%
  summarise(meanFlipper= mean(flipper_length_mm, na.rm=TRUE), stdDev = sd(flipper_length_mm, na.rm=TRUE), stdError = sd(flipper_length_mm, na.rm=TRUE)/sqrt(nrow(penguins)), lowercI = mean(flipper_length_mm, na.rm=TRUE) - .95*sd(flipper_length_mm, na.rm=TRUE)/sqrt(nrow(penguins)), upperCI = mean(flipper_length_mm, na.rm=TRUE) + .95*sd(flipper_length_mm, na.rm=TRUE)/sqrt(nrow(penguins)))
pipeVersion
```

### General Graphing Notes:
we'll be talking about lots of ways you can make graphs. Things that we won't talk about today (but may be helpful):
- APA style graphs https://rdrr.io/cran/jtools/man/theme_apa.html
```{r}
library(jtools)
```

## Learning Outcomes 2 & 3:Create bar graphs,histograms, scatterplots, line graphs, and box plots in R. Change aesthetic properties of graphs, including themes and colors

To create graphs, we'll be using `ggplot()`. While some customizations are general (you can do them to any graph), others may feel more specific to one or two types of graphs. As we go through some examples, I'll try to point out which are general or specific. If you have questions, **please be sure to ask**.

We also won't be able to cover everything this week. If you have questions, let me know and I will do my best to include them next week. 

**Notes about ggplot2**
ggplot makes graphs in layers. I'll try to demonstrate:

Here is an "empty graph" 
```{r}
ggplot()
```
You'll notice that the Plot window opened on my version of R and contains a gray background. This is a default "empty graph."

The next step is to include a dataset and to include an argument called aesthetics. It will look something like this: 

`ggplot(data, aes(x,y))`

In our case, we'll use the diamonds dataset again and see what happens when we include an x variable. 
```{r}
ggplot(diamonds, aes(price))
```

You'll notice that now we have an x axis, labeled x with values on it. 

This `ggplot()` section is the base of our graph. We add additional parts using a + sign. 

**histogram** 
We'll start with histograms because we only need one variable to make one. To do this, we can add `+geom_histogram()` to our code above. 

```{r}
ggplot(diamonds, aes(price))+ geom_histogram()
```

**Changing the background**
I really don't like the gray background (personal preference). So the first customization we'll do is remove the background using a themes argument.
```{r}
ggplot(diamonds, aes(price))+geom_histogram()+ theme_classic()
```
It can be used with any graph. 

**Changing colors** 
There are two additional arguments we can use to change the colors; color and fill. color will change the lines of the bars and fill will change the color of the bars. (this will be true for both histograms and bar graphs). 

Note: color and fill go in the histogram layer
```{r}
ggplot(diamonds, aes(price))+geom_histogram(color= "green4", fill= "#58CC1F")+ theme_classic() #HTML colors are SO COOL I LOVE THEM PLEASE LET ME HAVE THEM
```
**Note**You can also put the color and fill arguments in the `aes()` section. As your graphs get more complicated, you will notice that placement matters and will result in slightly different graphs. We're not going to go that far today though.

**Just because you can use a color scheme, doesn't mean you should** 

#### Histogram Practice: 
1. Create a histogram of the bill length variable. 
```{r}
ggplot(penguins, aes(bill_length_mm))+geom_histogram()
```
2. Include a theme to change the appearance of your graph.
```{r}
ggplot(penguins, aes(bill_length_mm))+geom_histogram()+ theme_classic()
```

3. Create a histogram with orange bars and purple lines. 
```{r}
ggplot(penguins, aes(bill_length_mm))+geom_histogram(bins=20, color = "purple", fill = "orange")+ theme_classic()
```

4. **Bonus** Create a histogram with the worst color combination you can think of. 
```{r}
ggplot(penguins, aes(bill_length_mm))+geom_histogram(bins= 30, color = "#F3DE2C", fill = "#001427")+ theme_bw()
```

**Bar graph** 
Next, we'll talk about how to make a bar graph. We can do this the same way we make a histogram, but will use `geom_bar()`. 

We'll practice on the "clarity" column. (I'll use another theme so you can see the differences)

```{r}
ggplot(diamonds, aes(clarity))+ geom_bar(fill="yellow")+theme_dark()
```

**Changing the x and y label axes** 
You'll notice that our y axis is "count" and our x axis is "clarity". These are not particularly informative. We can change these using xlab and ylab. 
```{r}
ggplot(diamonds, aes(clarity))+ 
  geom_bar(color="black", fill="lightgreen")+ 
  theme_classic()+ 
  xlab("Clarity of Diamond")+ 
  ylab("Frequency")+ 
  ggtitle("Graph of Diamond Clarity")
```

you can also choose to use labs, with x, y, and title
```{r}
ggplot(diamonds, aes(clarity))+ 
  geom_bar(color="black", fill="lightgreen")+ 
  theme_classic()+ 
  labs(title = "Graph of Diamond Clarity", x = "Clarity of Diamond", y = "Frequency")
```

Note - \n- starts a new line 
```{r}
ggplot(diamonds, aes(clarity))+ 
  geom_bar(color="red2", fill="green", linewidth=10)+ 
  theme(panel.background = element_rect(fill="yellow"))+ 
  labs(title = "Graph of Diamond Clarity", x = "Clarity of \nDiamond", y = "Frequency")
```

**Using means in bar graphs**
Sometimes, we don't just want the count of a category to make a bar graph. For instance, we may want to use a mean. We can do this by using the summary data frame we made before. 

```{r}
ggplot(priceByColor, aes(color, price))+ geom_bar(stat="identity")
```

**standard errors**
Using this dataset also allows us to include standard error bars or confidence intervals in our plots. We do this by adding a layer called `geom_errorbar(aes(ymin, ymax))`. 
```{r}
ggplot(priceByColor, aes(color, price))+ 
  geom_bar(stat="identity", fill= "lightblue")+ 
  geom_errorbar(aes(ymin= price - se, ymax= price + se))+
  theme_classic()
```

```{r}
ggplot(priceByColor, aes(color, price))+ 
  geom_bar(stat="identity", color = "#395E66", fill= "#32936F", alpha=.8)+ 
  geom_errorbar(aes(ymin= price - se, ymax= price + se, width=.5), color = "#764134")+
  theme_bw()
```

Things I included:
- width: to get error bars to fit on top of bars 
- alpha: transparency of bars

**Note:** there are several cases where the you may to include the argument `position_dodge()` to get the standard error bars to align with the actual bars on your graph. We may go through an example of this later, but if we don't have time, R cookbook has really good examples of how to do this. 

**adding lines** (hline/vline)
```{r}
ggplot(priceByColor, aes(color, price))+ 
  geom_bar(stat="identity", color = "#395E66", fill= "#32936F", alpha=.8)+ 
  geom_errorbar(aes(ymin= price - se, ymax= price + se, width=.5), color = "#764134")+
  theme_bw()+ geom_hline(yintercept = mean(diamonds$price), size= 1, linetype= "dashed", color= "blue4")
```

```{r}
ggplot(priceByColor, aes(color, price))+ 
  geom_bar(stat="identity", color = "#395E66", fill= "#32936F", alpha=.8)+ 
  geom_errorbar(aes(ymin= price - se, ymax= price + se, width=.5), color = "#764134")+
  theme_bw()+ geom_vline(xintercept = "G", color="blue4") #better to explicitly code where the line should go
```

Things I changed: 
- alpha: how transparent a layer is
- width: how wide something is (can be applied to bars, error bars)
- linetype: solid, dashed or something else
- color: changes the color of lines (whether borders or lines)
- size: changes how big something is 
**Note:** `geom_vline()` works the same way,but you need to specify where it crosses the x intercept. 

### Practice: 
1. Create a bar graph for the species column. 
```{r}
ggplot(penguins, aes(species))+ geom_bar(color= "#395E66", fill= "#32936F")
```

2. Change the x and y labels to something that is more informative.
```{r}
ggplot(penguins, aes(species))+ 
  geom_bar(color= "#7D5BA6", fill= "#92DCE5")+
  xlab("\nPenguin Species")+
  ylab("\nNumber of Penguins")+
  ggtitle("\nPenguin Species Count Across Islands")+
  theme_bw()
```


### Adding a second variable to a bar graph: 
```{r}
ggplot(diamonds, aes(color, fill=cut))+
  geom_bar()+
  theme_bw() #stacked

ggplot(diamonds, aes(color, fill=cut))+
  geom_bar(position=position_dodge())+
  theme_bw() #categorical
```

```{r}
data(mtcars)
ggplot(mtcars, aes(cyl, fill=as.factor(mpg)))+
  geom_bar()+
  theme_bw() # OW MY EYES THAT HURTS DONT OPEN THAT
```


**Scatter plot**
We can make scatter plots using the argument `geom_point()`. We'll make a graph of carat by price. 
```{r}
ggplot(diamonds, aes(carat, price))+
  geom_point()+
  theme_bw()
```

```{r}
ggplot(diamonds, aes(carat, price))+
  geom_point(color= "#324376")+ #there's no real "fill" option, sorgy
  theme_bw()
```

```{r}
ggplot(diamonds, aes(carat, price))+
  geom_point(color= "#F68E5F", size= 1, shape= 5)+ #there's no real "fill" option, sorgy
  theme_bw()
```

#jitter()
```{r}
ggplot(mtcars, aes(cyl, gear))+
  geom_point()+
  theme_bw()

ggplot(mtcars, aes(cyl, gear))+
  geom_jitter()+
  theme_bw() #This introduces variability, but is a little misleading. Only add this to other graphs to get a sense of variability
```

### Practice
- make a scatter plot of bill length and bill depth. 
```{r}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm))+
  geom_point()
```

- modify the graph to include at least 2of the style elements we talked about
```{r}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm))+
  geom_point(color= "#313D5A", size= 3, shape= 8)+
  theme_bw()
```

**Note:**In this case, `geom_point()` is the best option to make our scatter plot. If you work with small datasets, the points may be overlapping and make it look like you have less data. In these cases, you can use `geom_jitter()`, which will offset the dots slightly and allow you to see each participant.  

**Inserting a regression line**
We can include a regression line into our graph using `geom_smooth()`.
```{r}
ggplot(diamonds, aes(carat, price))+
  geom_point()+
  geom_smooth(method="lm", size=1, color="orange", linetype="dashed")+
  theme_bw()
```
We can customize whether the regression line has a confidence interval surrounding it. You may be asking yourself **what confidence interval**. Carat and price are very highly correlated. let's use an mtcars example to see how we can change it. 
w/ 95% confidence interval shaded
```{r}
ggplot(mtcars, aes(mpg, hp))+
  geom_point()+
  geom_smooth(method="lm", se= FALSE) #se= FALSE doesn't need to be removed, it gives more info, but this is how to remove it
```
**Changing scatterplots**
you can change the outline of a dot using "color" 
```{r}
ggplot(diamonds, aes(carat, price, color=color))+
  geom_point()
```

####Practice: 
1. Create a scatter plot of the body mass and flipper length variables. 
```{r}
ggplot(penguins, aes(body_mass_g, flipper_length_mm))+
  geom_point()
```
2. Change the color of the points to your favorite color. 
```{r}
ggplot(penguins, aes(body_mass_g, flipper_length_mm))+
  geom_point(color="#58cc1f")
```
3. Change the shape of the points. 
```{r}
ggplot(penguins, aes(body_mass_g, flipper_length_mm))+
  geom_point(color="#58cc1f", shape=15)
```
4. Add a line of best fit to your scatter plot. 
```{r}
ggplot(penguins, aes(body_mass_g, flipper_length_mm))+
  geom_point(color="#58cc1f", shape=15)+
  geom_smooth(method="lm", color= "#5A2328", linetype="dashed")+
  theme_bw()
```

**Line graphs**
Line graphs follow a similar to scatterplots, but use the geom_line function. Color customizations follow the same rules as scatterplots. 
include group in aes
```{r}
data("ChickWeight")
ggplot(ChickWeight, aes(Time, weight, group=Chick))+
  geom_line()
```

```{r}
ggplot(ChickWeight, aes(Time, weight, group=Chick, color=Chick))+
  geom_line()
```

I won't talk as much about these graphs, but happy to answer questions. 

**Box plots**
I hope that the pattern is starting to make sense, but the only difference with a box plot is that you'll use `geom_boxplot()`. 
```{r}
ggplot(diamonds, aes(price))+
  geom_boxplot()
```

```{r}
ggplot(diamonds, aes(color, price))+
  geom_boxplot()
```

```{r twoVariableBoxplot}
ggplot(diamonds, aes(color, price))+
  geom_boxplot(color= "black", fill="lightblue")
```
```{r}
ggplot(diamonds, aes(color, price))+
  geom_boxplot(color= "black", fill="lightblue")+
  geom_jitter()
```
```{r}
ggplot(mtcars, aes(as.factor(cyl), mpg))+
  geom_boxplot()+
  geom_jitter()
```
### Violin Plot
```{r}
ggplot(diamonds, aes(color, price))+ geom_violin()
```
```{r}
ggplot(mtcars, aes(as.factor(cyl), mpg))+
  geom_violin()+
  geom_jitter()
```

### Practice: 
1. Create a boxplot for flipper length.
```{r}

```

2. Create boxplots of flipper length for each species.
```{r}

```

3. **Bonus** play around with fill and color. What changes about your boxplots? 
```{r}

```

## Learning Outcome 4:Incorporate third variables into graphs
There are many ways that we can include third variables. 

For histograms/bar graphs: 
use fill = 
price histogram
```{r}
ggplot(diamonds, aes(price, fill=color))+
  geom_histogram(bins=15)
```

For scatter plots: 
color = 
```{r}
ggplot(diamonds, aes(price, carat, color=cut))+
  geom_point()
```

Rather than having all bars/dots/lines the same color, you can have them change by using various packages and by looking up a few color codes online. 

If you don't like the colors, we can specify specific ones using `scale_fill_manual()` OR using a package called R color brewer `scale_color_brewer()`  or viridis. 
(need to specify option for color scales)
We'll walk through these together because I think it's helpful to see what color combinations exist and how you can use them in a bar graph or a scatter plot.
```{r}
ggplot(diamonds, aes(price, fill=color))+
  geom_histogram(position=position_dodge(), bins=15)+
  scale_fill_manual(values=c("#726DA8", "#71B340", "#00ABE7", "#DE6E4B", "#FDE74C", "#21D19F", "#56351E"))
```
`scale_color_manual(values = #)`; 
```{r}
ggplot(diamonds, aes(price, carat, color=cut))+
  geom_point()+
  scale_color_manual(values=c("#820933", "#D84797", "#D2FDFF", "#3ABEFF", "#26FFE6"))
```

R ColorBrewer
`scale_color_brewer(palette=)`
```{r}
library(RColorBrewer)
ggplot(diamonds, aes(price, carat, color=cut))+
  geom_point()+
  scale_color_brewer(palette = "GnBu")+
  theme_bw()

ggplot(diamonds, aes(price, fill=color))+
  geom_histogram()+
  scale_fill_brewer(palette="Set2")

# You can find the palettes through google
```

Viridis
`scale_color_viridis()`
```{r}
library(viridis)
ggplot(diamonds, aes(price, fill=color))+
  geom_histogram()+
  scale_fill_viridis(discrete=TRUE, option="C")

ggplot(diamonds, aes(price, carat, color=cut))+
  geom_point()+
  scale_color_viridis(discrete=TRUE, option="C")
```


### Learning Outcome 4 Practice. 
1. Create a graph of bill length and island
```{r}
ggplot(penguins, aes(island, bill_length_mm))+
  geom_boxplot()
```

2. In some way, include species as a third variable in this graph. 
```{r}
ggplot(penguins, aes(island, bill_length_mm, fill=species))+
  geom_boxplot()
```

3. Create a graph of bill length and bill depth
```{r}
ggplot(penguins, aes(bill_depth_mm, bill_length_mm))+
  geom_point()
```
4. In some way, include species as a third variable.
```{r}
ggplot(penguins, aes(bill_depth_mm, bill_length_mm, color=species))+
  geom_point()
```